---
layout: post
title: 210107-TIL
category: TIL
permalink: /til/:year/:month/:day/:title/


tags: [TIL]
comments: true
---

# 학습 내용
- 프로젝트 수정
- DispatchQueue
- Error Handling

<br>

# 고민한 점 / 해결 방법

####  [DispatchQueue, 스레드 순서?]
- 원래 은행원 3명을 동작시켜주기 위한 코드로 for 구문을 사용했다. 하지만 첫번째 은행원이 didSet의 늪에 빠져버리면서 결과적으로 혼자만 일하는 상황이 발생했다. 동시에 일을 시켜주고 싶었다.

```swift
for i in 1...3 {
    let num = i * 10
    DispatchQueue.global().async {
        for x in num ... num + 9 {
            print(x, "-----> \(i)입니다.")
        }
    }
}
```

- 이런 코드를 썼을 때, 10, 20, 30, 11, 21, 31, ... 이렇게 한번씩 돌아가면서 처리가 될줄 알았는데 첫 숫자를 제외하고는 뒤죽박죽이었다. 심지어 10, 20, 30도 가끔  10, 30, 20 처럼 30이 먼저 출력될 때가 있었다. 왜 이렇게 뒤죽박죽으로 처리가 될까?
- 스레드는 번호가(순서가) 없었다. 디스패치 큐로 보내는 순간 내 손을 떠나게 된다. 그리고 동시에 처리되는 디스패치 큐에서는 어떤 예상되는 논리를 기대할 수 없었다. 학생을 책상 앞에 앉히더라도 공부는 학생의 몫인 것처럼 디스패치 큐를 제어할 수는 없었다.

#### [race condition, 동시성]
- 하나의 딕셔너리에 3개의 스레드가 접근하려니 에러가 발생했다. race condition이라고 한다.
- 동시에 접근하지 않도록 접근을 막아주는 방법은 없을까? DispatchSemaphore를 써보았다. DispatchSemaphore는 하나의 스레드만 값에 접근할 수 있도록 다른 스레드의 접근을 막아주는 기능을 한다.
- 하지만 결과적으로 race condition은 해결되지 않았다. 디스패치 큐의 동시성 프로그래밍은 '동시에 처리하는 것처럼 보이도록' 일을 처리한다. 물리적으로 동시가 아니다. 따라서 race condition은 당연히 해결될거라 예상했는데 해결되지 않았다.
- 프로젝트의 설계를 수정하여 고객 리스트를 처리하는 방법을 바꿔줘야할 것 같다.

#### [안전성, 휴먼 에러]
- 파라미터에 넣어줘도 되는 변수나 상수를 타입의 프로퍼티로 만들어줄 필요가 있을까.
- 처음에는 불필요한 프로퍼티라고 판단이 들었으나 피드백을 받으면서 다시 생각해보게 되었다. 프로퍼티를 만들면 저장 공간이 소요되는 것이 불필요하다고 생각했다. 하지만 유지보수의 측면에서 프로퍼티를 만들어주면 더 안전하다고 생각하게 되었다.
- 전달인자에 상수로서 값을 전달해주면, 우선 해당 값을 수정해야할때 코드를 찾는 에너지가 많이 들어갔다. 또한 수정이 직관적이지 못하고 관계를 항상 생각해야했다. 프로퍼티로 만들어두는 것이 코드에 다시 접근하는 효율이 더 좋은 것 같다. 즉 휴먼에러를 줄일 수 있는 방향인 것 같다.

<br>

# 느낀점
- 코드의 안전성에 대해서 여러 지점에서 고민을 한 것 같다. 충분히 안전할 것 같았고, 굳이? 라는 생각이 드는 부분들도 있었으나 더 나은 방향에 대해서 고민해볼 수 있어서 좋았다.
- 에러핸들링을 구현하면서 이니와 짝프로그래밍을 해보았다. 네비게이터 역할을 했는데 아는 내용을 디테일하게 설명해야했기 때문에 내가 평소에 놓치던 조그만한 부분들도 캐치할 수 있었다.
- 수업시간에 동시성, GCD에 대해서 이야기를 나누었는데 두루뭉실하게 이해했던 내용들을 토의하면서 더 명확하게 이해할 수 있었다. 내일 이 내용을 복습해보도록 하겠다.
