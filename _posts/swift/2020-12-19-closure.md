---
layout: post
title: 클로져 (Closure)
category: Swift
tags: [Closure]
comments: true
---
>이 글은 공부 중에 작성하는 글입니다.    
>정정이 필요한 내용은 댓글로 알려주시면 감사하겠습니다 :)

<br>

안녕하세요 오동나무입니다.  <br>

저번 시간에 고차함수에 대해서 공부하면서 클로저 문법이 많이 등장했습니다. 저는 처음에 클로저가 옵셔널 다음으로 이해가 안되기도 했고, 아직도 익숙하지 못한 것 같아서 정리 차원에서 포스팅합니다.

<br>
<br>

# 클로저와 함수
클로저는 '**코드의 블럭**'입니다. 그리고 **일급 객체**이자 **함수**이기도 합니다. 일급 객체는 짧게 아래의 설명과 같습니다.

>일급 객체(First Class Citizen)의 조건
>1. 변수나 상수에 저장 및 할당 할 수 있어야 한다.  
>2. 파라미터(객체의 인자)로 전달 할 수 있어야 한다.
>3. 함수(객체)에서 return 할 수 있어야 한다.     

함수는 '이름이 있는 클로저'라고 불리기도 합니다. 클로저가 함수를 포함하는 범주의 개념이라고 할 수 있겠네요. <br>

함수는 클로저이기도 하고, 반대로 클로저는 일회용 함수이기도 합니다. 함수와 클로저는 어떤 공통점과 차이점이 있을까요?

> **공통점**
>  - 인자를 받을 수 있다.
>  - 값을 리턴할 수 있다.
>  - 변수로 할당할 수 있다.
>
> **차이점**
>  - 함수는 이름이 있고, 클로저는 이름이 없다.
>  - func의 유무

<br>

#### 클로저는 어디에 쓸까?
맨 처음 클로저를 접했을 때 들었던 의문이었습니다. 함수와 기능이 같은데 그렇다면 클로저는 어디에 쓰이기 위해서 존재하는 것일까요? **개인적인 생각입니다.**

```swift
let OKButton = UIAlertAction(title: "OK", style: .default, handler: nil)
```

alert 창을 만들 때, handler 파라미터가 생각이 나네요. 클로저는 실제로 하나의 타입으로서 사용하는 경우가 빈번합니다. <br>

또한 모든 동작을 함수로 정의한다면, 정의된 함수가 너무 많아질 것입니다. 반복해서 사용되는 것도 아니고, 단지 일회성으로 사용되는 함수들이 많아질수록 말입니다. 이때, 함수를 계속 정의하는 것 보다는 즉각적으로 사용할 수 있는 '일회성 함수' (클로저) 를 사용한다면 더욱 효율적인 코딩을 할 수 있습니다. 왜냐하면 클로저는 보다 간단한 형태로 표현될 수 있기 때문입니다.

<br>
<br>

# Closure (클로저)
클로저의 기본 형태는 아래와 같습니다.

```swift
{ (매개변수) -> 반환 타입 in
    실행할 구문    
}
```

이 기본 형태를 이용해서 add라는 상수에 클로저를 할당해보도록 하겠습니다.

```swift
let add = { (a: Int, b: Int) -> Int in
     return a + b
}
add(1, 2) // 3    
```      

```swift
func calculate(a: Int, b: Int, method: (Int, Int) -> Int) -> Int {
    return method(a, b)
}
var result: Int
```      

이 경우, calculate 함수의 method 파라미터가 클로저(함수)의 형태로 되어있네요.

<br>

##  다양한 형태의 클로저
클로저는 표현할 수 있는 형태가 다양합니다. 반환 타입, 파라미터  등등의 요소를 생략 및 축약하여 표현할 수 있기 때문입니다. 그러면 위의 calculate함수의 기본 형태를 하나씩 축약시켜 보도록 하겠습니다.

```swift
result = calculate(a: 10, b: 10) { (left: Int, right: Int) -> Int in
    return left + right
}
print(result) // 20       
```      

먼저 후행 클로저라는 중요한 개념입니다. 후행 클로저로 클로저 타입을 받는 파라미터를 괄호 밖으로 빼주면서 보다 깔끔하게 정리할 수 있습니다. 다른 말로 트레일링 클로저라고도 하는 것 같습니다. <br>

이때 중괄호 안에 반환 값 앞에 in이라는 키워드를 적어주야 합니다!       

```swift
result = calculate(a: 10, b: 10) {
    return $0 + $1
}
print(result) // 20
```     

그리고 $ 기호를 사용하는 단축인자 이름으로도 축약이 가능합니다. 파라미터와 return 값을 동시에 표현해줌으로서 보다 축약된 코드를 쓸 수 있습니다. <br>

그리고 return마저 생략해줄 수 있는데요,

```swift
result = calculate(a: 10, b: 10) { $0 + $1 }
print(result) // 20
```      

그러면 최종적으로 이만큼이나 축약된 클로저를 작성할 수 있습니다. 이 경우, 마지막 코드는 당연히 return 값이겠거니.. 하며 클로저가 똑똑하게 추측하기 때문에 생략이 가능합니다. 축약 전과 비교해보면 엄청 간단하게 코드가 다이어트된 것을 확인할 수 있습니다.

```swift
//축약 전
result = calculate(a: 10, b: 10, method: { (left: Int, right: Int) -> Int in
    return left + right
})

//축약 후
result = calculate(a: 10, b: 10) { $0 + $1 }

print(result) // 20
```

<br>

## 얼마나 축약해서 써야할까?
**역시 개인적인 생각입니다.** 설명했듯이 클로저는 얼마나 축약을 하느냐에 따라 아주 다양하게 표현될 수 있습니다. 얼마나 축약을 해서 쓰는 것이 좋다는 것은 없지만, 너무 많은 생략을 하게 된다면 코드가 명확하게 파악되지 않을 가능성이 있기 때문에 가독성에 필요한 만큼의 정보는 남기는 것이 좋습니다. 또한 협업을 하게 된다면 클로저의 형태에 대한 약속이 필요할 수도 있습니다.

<br>
<br>

#### 참고
- [https://yagom.net/courses/swift-basic/lessons/클로저/topic/다양한-클로저-표현/](https://yagom.net/courses/swift-basic/lessons/클로저/topic/다양한-클로저-표현/)

<br>
